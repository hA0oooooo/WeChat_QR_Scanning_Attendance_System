{% extends 'base.html' %}

{% block title %}教师仪表盘 - 微信扫码考勤系统{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- 教师信息卡片 -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">个人信息</h5>
                    <div class="text-center mb-3">
                        <img src="https://via.placeholder.com/150" class="rounded-circle" alt="头像">
                    </div>
                    <p><strong>姓名：</strong>{{ user.username }}</p>
                    <p><strong>工号：</strong>{{ user.teacher.teacher_id }}</p>
                    <p><strong>院系：</strong>{{ user.teacher.department.name }}</p>
                    <p><strong>职称：</strong>{{ user.teacher.title }}</p>
                </div>
            </div>
        </div>

        <!-- 今日课程 -->
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">今日课程</h5>
                    {% if today_courses %}
                        {% for course in today_courses %}
                        <div class="card mb-2">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">{{ course.name }}</h6>
                                        <p class="mb-0 text-muted">
                                            <small>{{ course.schedule }} | {{ course.location }}</small>
                                        </p>
                                    </div>
                                    <div>
                                        <a href="{% url 'create_attendance_event' %}?course={{ course.id }}" 
                                           class="btn btn-primary btn-sm">
                                            发起考勤
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-info">
                            今日暂无课程安排
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- 待处理事项 -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">待处理事项</h5>
                    <div class="list-group">
                        {% if pending_leave_requests %}
                            <a href="{% url 'leave_request_list' %}" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">待审批请假申请</h6>
                                    <span class="badge bg-primary rounded-pill">{{ pending_leave_requests|length }}</span>
                                </div>
                                <small class="text-muted">点击查看详情</small>
                            </a>
                        {% endif %}
                        {% if active_attendance_events %}
                            <a href="{% url 'teacher_courses' %}" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">进行中的考勤</h6>
                                    <span class="badge bg-primary rounded-pill">{{ active_attendance_events|length }}</span>
                                </div>
                                <small class="text-muted">点击查看详情</small>
                            </a>
                        {% endif %}
                        {% if not pending_leave_requests and not active_attendance_events %}
                            <div class="alert alert-info">
                                暂无待处理事项
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 最近考勤统计 -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">最近考勤统计</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h6 class="card-title">总考勤次数</h6>
                                    <p class="card-text display-6">{{ total_attendance_count }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h6 class="card-title">正常出勤</h6>
                                    <p class="card-text display-6">{{ normal_attendance_count }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <h6 class="card-title">迟到次数</h6>
                                    <p class="card-text display-6">{{ late_count }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body">
                                    <h6 class="card-title">缺勤次数</h6>
                                    <p class="card-text display-6">{{ absent_count }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 