# 测试数据说明文档

## 概述

本系统采用模块化的测试数据管理方式：
- **`tests/`文件夹**：负责具体的测试数据初始化逻辑
- **`init_test_data.py`**：作为主入口，调用tests模块中的函数

这种设计使得测试数据的创建逻辑更加清晰，便于维护和扩展。

## 快速开始

### 初始化测试数据

```bash
# 在项目根目录运行
python init_test_data.py

# 初始化完成后，启动Django服务器
python manage.py runserver

# 在浏览器中访问
http://127.0.0.1:8000/
```

**特性说明：**
- 每次运行都会完全清除所有现有数据（包括用户账号）
- 所有账号密码统一设置为 `1`，便于测试
- 一键重置整个测试环境，确保数据一致性

## 登录账号

初始化完成后，可以使用以下账号登录系统：

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 管理员 | `admin` | `1` | 系统管理员，可管理所有数据 |
| 教师 | `12345` | `1` | 郑老师，工号12345 |
| 学生 | `23307130001` | `1` | 开心，学号23307130001 |

## 系统架构

### 组织架构
- **院系**：大数据学院
- **专业**：数据科学与大数据技术

### 课程信息
- **课程代码**：DATA130039.01
- **课程名称**：数据库及实现
- **学分**：3学分
- **上课时间**：星期三第3-5节（9:55-12:30）
- **上课地点**：HGX508
- **扫码有效时间**：9:55-12:30（与课程时间一致）

## 人员信息

### 教师
- **姓名**：郑老师
- **工号**：12345
- **所属院系**：大数据学院
- **登录账号**：12345 / 1

### 学生
- **姓名**：开心
- **学号**：23307130001
- **性别**：男
- **专业**：数据科学与大数据技术
- **登录账号**：23307130001 / 1
- **微信OpenID**：wx_openid_23307130001

## 考勤数据设计

### 考勤事件
系统自动创建3个考勤事件，模拟完整的课程周期：

| 日期 | 描述 | 扫码时间 | 状态 | 用途 |
|------|------|----------|------|------|
| 2025-06-11 | 第一次课 | 9:55-12:30 | 已完成 | 历史数据，学生出勤 |
| 2025-06-18 | 第二次课 | 9:55-12:30 | 进行中 | 演示扫码签到功能 |
| 2025-06-25 | 第三次课 | 9:55-12:30 | 未开始 | 演示请假申请功能 |

### 考勤记录状态
- **6月11日**：学生开心 - 出勤（签到时间：10:00）
- **6月18日**：学生开心 - 缺勤（等待扫码，演示时可变为出勤）
- **6月25日**：学生开心 - 未开始（可申请请假）

### 请假管理
- **初始状态**：无请假申请（便于演示申请流程）
- **可演示功能**：
  - 学生申请6月25日课程请假
  - 教师审批请假申请
  - 请假记录动态显示

## 演示场景

### 当前模拟时间
**2025年6月18日 11:00**（课程进行中）

### 演示流程建议

1. **管理员登录**（admin/1）
   - 查看系统整体数据
   - 管理用户和课程信息

2. **教师登录**（12345/1）
   - 查看课程和学生信息
   - 管理考勤事件
   - 审批请假申请

3. **学生登录**（23307130001/1）
   - 查看个人课程和考勤记录
   - 扫码签到（模拟6月18日签到）
   - 申请请假（为6月25日课程申请）

### 出勤率计算
- **总课程数**：2次（排除未开始的6月25日）
- **出勤次数**：1次（6月11日出勤）
- **出勤率**：50%
- **演示后**：扫码签到后出勤率变为100%

## 技术实现

### tests文件夹结构
```
tests/
├── __init__.py                      # Python包初始化文件
└── test_data_initialization.py      # 测试数据创建模块
```

### 模块化设计

#### `tests/test_data_initialization.py`
负责具体的数据创建逻辑，包含以下函数：

- `create_basic_data()` - 创建基础数据（部门、专业、课程）
- `create_users_and_roles()` - 创建用户账号和角色（管理员、教师、学生）
- `create_course_data()` - 创建课程相关数据（选课、考勤事件、考勤记录）
- `clear_leave_requests()` - 清空请假申请，准备演示环境
- `create_test_data()` - 主函数，协调所有数据创建流程

#### `init_test_data.py`
作为主入口文件，职责：
- 设置项目路径和Django环境
- 调用tests模块中的函数
- 提供友好的用户界面和进度提示
- 显示初始化结果和使用说明

### 数据清理策略

`init_test_data.py` 脚本采用彻底清理策略：
1. 按依赖关系顺序删除，避免外键约束错误
2. 清除所有用户（包括超级用户），确保环境干净
3. 重新创建完整的测试数据集
4. 提供详细的创建进度提示

### 密码设置
- **统一密码**：所有账号密码都是 `1`
- **安全性**：仅用于开发和测试环境
- **便利性**：简化测试流程，便于快速验证功能

## 扩展说明

### 添加更多学生
如需要更多学生账号进行测试，可以修改 `tests/test_data_initialization.py` 中的 `create_users_and_roles()` 函数，在学生创建部分添加更多学生数据。

### 自定义考勤场景
可以修改 `create_course_data()` 函数中的 `events_data` 列表，调整考勤事件的日期和描述，创建不同的演示场景。

### 批量数据处理
tests模块的设计支持批量数据处理，可以根据需要扩展为创建大量测试数据的场景。



 